<!-- web/templates/controller_status.html -->
<!DOCTYPE html>
<html>
<head>
    <title>PlayAble - Controller Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 2em; }
        h1 { text-align: center; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2em; max-width: 800px; margin: auto; }
        .panel { background: white; padding: 1.5em; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .panel h2 { margin-top: 0; }
        .buttons span {
            display: inline-block;
            padding: 10px 14px;
            margin: 5px;
            border-radius: 6px;
            background-color: #ddd;
            font-weight: bold;
        }
        .buttons .active {
            background-color: #007bff;
            color: white;
        }
        .stick-container, .trigger-bar {
            margin-top: 10px;
        }
        .stick {
            width: 120px; height: 120px; background: #eee; border-radius: 50%; position: relative;
        }
        .stick-dot {
            width: 12px; height: 12px; background: red; border-radius: 50%; position: absolute;
            transform: translate(-50%, -50%);
        }
        .bar {
            height: 20px;
            background: #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            background: #28a745;
            width: 0;
        }
    </style>
    <script>
        async function updateStatus() {
            const res = await fetch('/controller_status');
            const data = await res.json();

            // Buttons
            const buttons = ["X","O","â–¢","â–³","L1","R1","L2","R2","Share","Options","L3","R3"];
            const container = document.getElementById("buttons");
            container.innerHTML = "";
            buttons.forEach(b => {
                const el = document.createElement("span");
                el.textContent = b;
                if (data.buttons.includes(b)) el.classList.add("active");
                container.appendChild(el);
            });

            // Joysticks
            const lx = (data.lx - 128) / 2; // normalize to -64 to +64
            const ly = (data.ly - 128) / 2;
            const dotL = document.getElementById("dot-l");
            dotL.style.left = 60 + lx + "px";
            dotL.style.top = 60 + ly + "px";

            const rx = (data.rx - 128) / 2;
            const ry = (data.ry - 128) / 2;
            const dotR = document.getElementById("dot-r");
            dotR.style.left = 60 + rx + "px";
            dotR.style.top = 60 + ry + "px";

            // Triggers
            document.getElementById("l2-bar").style.width = data.l2 / 2.55 + "%";
            document.getElementById("r2-bar").style.width = data.r2 / 2.55 + "%";
        }

        setInterval(updateStatus, 200);
    </script>
</head>
<body>
    <h1>ðŸŽ® PlayAble - Controller Live View</h1>
    <div class="grid">
        <div class="panel">
            <h2>Buttons</h2>
            <div class="buttons" id="buttons"></div>
        </div>

        <div class="panel">
            <h2>Triggers</h2>
            <p>L2:</p>
            <div class="bar"><div class="bar-fill" id="l2-bar"></div></div>
            <p>R2:</p>
            <div class="bar"><div class="bar-fill" id="r2-bar"></div></div>
        </div>

        <div class="panel">
            <h2>Left Joystick</h2>
            <div class="stick-container">
                <div class="stick"><div class="stick-dot" id="dot-l"></div></div>
            </div>
        </div>

        <div class="panel">
            <h2>Right Joystick</h2>
            <div class="stick-container">
                <div class="stick"><div class="stick-dot" id="dot-r"></div></div>
            </div>
        </div>
    </div>
</body>
</html>
